<div class="card">
  <div class="button-row">
    <p-button
      class="btn"
      label="Upload"
      (onClick)="openFileUploader()"
    ></p-button>
    <p-inputNumber
      [(ngModel)]="inputValue"
      [showButtons]="false"
      [useGrouping]="false"
      [placeholder]="'Enter a number'"
      styleClass="p-inputtext-lg"
    ></p-inputNumber>
    <p-button
      label="Export"
      (onClick)="submitValue()"
      severity="success"
      class="p-mr-2"
    ></p-button>
    <div class="spacer"></div>
    <input
      type="text"
      pInputText
      placeholder="Search by model..."
      class="search-bar"
      [(ngModel)]="searchText"
      (ngModelChange)="onSearch()"
      (keyup.enter)="onSearch()"
    />
  </div>
  <div class="preview-section" *ngIf="filteredVehiclesPreview.length > 0">
    <div class="preview-header">
      <h3>Export Preview</h3>
      <p>
        {{ filteredVehiclesPreview.length }} vehicles will be exported (age >=
        {{ inputValue }} years)
      </p>
    </div>
    <div class="preview-actions">
      <p-button
        label="Confirm Export"
        severity="success"
        icon="pi pi-check"
        (onClick)="confirmExport()"
      >
      </p-button>
      <p-button
        label="Cancel"
        severity="secondary"
        icon="pi pi-times"
        (onClick)="cancelPreview()"
      >
      </p-button>
    </div>
    <div class="table-container">
      <p-table
        [value]="filteredVehiclesPreview"
        [tableStyle]="{ 'min-width': '80rem' }"
      >
        <ng-template pTemplate="header">
          <tr>
            <th>ID</th>
            <th>First Name</th>
            <th>Last Name</th>
            <th>Email</th>
            <th>Car Make</th>
            <th>Car Model</th>
            <th>VIN</th>
            <th>Manufactured Date</th>
            <th>Age of Vehicle</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-vehicle>
          <tr>
            <td>{{ vehicle.id }}</td>
            <td>{{ vehicle.first_name }}</td>
            <td>{{ vehicle.last_name }}</td>
            <td>{{ vehicle.email }}</td>
            <td>{{ vehicle.car_make }}</td>
            <td>{{ vehicle.car_model }}</td>
            <td>{{ vehicle.vin }}</td>
            <td>{{ vehicle.manufactured_date | date }}</td>
            <td>{{ vehicle.age_of_vehicle }}</td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>
  <div class="table-container">
    <p-table
      [value]="vehicles"
      [rows]="100"
      [totalRecords]="totalRecords"
      [lazy]="true"
      (onLazyLoad)="loadVehiclesLazy($event)"
      [paginator]="true"
      [tableStyle]="{ 'min-width': '80rem' }"
    >
      <ng-template pTemplate="header">
        <tr>
          <th>ID</th>
          <th>First Name</th>
          <th>Last Name</th>
          <th>Email</th>
          <th>Car Make</th>
          <th>Car Model</th>
          <th>VIN</th>
          <th>Manufactured Date</th>
          <th>Age of Vehicle</th>
          <th>Actions</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-vehicle>
        <tr>
          <td>{{ vehicle.id }}</td>
          <td>{{ vehicle.first_name }}</td>
          <td>{{ vehicle.last_name }}</td>
          <td>{{ vehicle.email }}</td>
          <td>{{ vehicle.car_make }}</td>
          <td>{{ vehicle.car_model }}</td>
          <td>{{ vehicle.vin }}</td>
          <td>{{ vehicle.manufactured_date | date }}</td>
          <td>{{ vehicle.age_of_vehicle }}</td>
          <td>
            <p-button
              icon="pi pi-pencil"
              severity="warning"
              [text]="true"
              [rounded]="true"
              (onClick)="editVehicle(vehicle)"
            >
            </p-button>
            <p-button
              icon="pi pi-trash"
              severity="danger"
              [text]="true"
              [rounded]="true"
              (onClick)="deleteVehicle(vehicle)"
            >
            </p-button>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="9" style="text-align: center">No vehicles found</td>
        </tr>
      </ng-template>
    </p-table>
  </div>
  <!-- Edit Dialog -->
  <p-dialog
    header="Edit Vehicle"
    [(visible)]="displayEditDialog"
    [modal]="true"
    [style]="{ width: '50vw' }"
    [draggable]="false"
    [resizable]="false"
  >
    <div class="edit-form" *ngIf="selectedVehicle">
      <div class="p-fluid">
        <div class="p-field">
          <label>First Name</label>
          <input
            type="text"
            pInputText
            [(ngModel)]="selectedVehicle.first_name"
          />
        </div>

        <div class="p-field">
          <label>Last Name</label>
          <input
            type="text"
            pInputText
            [(ngModel)]="selectedVehicle.last_name"
          />
        </div>

        <div class="p-field">
          <label>Email</label>
          <input type="email" pInputText [(ngModel)]="selectedVehicle.email" />
        </div>

        <div class="p-field">
          <label>Car Make</label>
          <input
            type="text"
            pInputText
            [(ngModel)]="selectedVehicle.car_make"
          />
        </div>

        <div class="p-field">
          <label>Car Model</label>
          <input
            type="text"
            pInputText
            [(ngModel)]="selectedVehicle.car_model"
          />
        </div>
      </div>
    </div>

    <ng-template pTemplate="footer">
      <p-button
        label="Cancel"
        icon="pi pi-times"
        (onClick)="displayEditDialog = false"
        severity="secondary"
      ></p-button>
      <p-button
        label="Save"
        icon="pi pi-check"
        (onClick)="saveVehicle()"
        severity="success"
      ></p-button>
    </ng-template>
  </p-dialog>
</div>
